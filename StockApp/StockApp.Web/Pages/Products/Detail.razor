@page "/products/{customId}"
@using System.Globalization
@using StockApp.Domain.Enums
@inherits DetailProductPage

<MudText Class="title" Typo="Typo.h5">Edição / Visualização de Produto</MudText>

<div class="product-detail-header">
    <MudGrid>
        <MudItem xs="12" sm="12">
            <MudTextField Disabled="true"
                          Variant="Variant.Outlined"
                          T="string"
                          @bind-Value="Product.CustomId"
                          Label="Código"
                          Adornment="Adornment.Start"
                          AdornmentIcon="@Icons.Material.Filled._123"/>
        </MudItem>
        <MudItem xs="12" sm="12">
            <MudTextField Disabled="true" T="string"
                          Label="Data de Cadastro:"
                          Variant="Variant.Outlined"
                          Value="Product.CreatedDate.ToString(CultureInfo.CurrentCulture)"
                          Adornment="Adornment.Start"
                          AdornmentIcon="@Icons.Material.Filled.CalendarMonth"/>
        </MudItem>
        <MudItem xs="12" sm="12">
            <MudTextField Disabled="true" T="string"
                          Label="Ultima atualização:"
                          Adornment="Adornment.Start"
                          Value="Product.UpdatedDate.ToString(CultureInfo.CurrentCulture)"
                          Variant="Variant.Outlined"
                          AdornmentIcon="@Icons.Material.Filled.EditCalendar"/>
        </MudItem>
    </MudGrid>

    <div class="image-container">
        <MudImage Src="https://picsum.photos/300?random=1"
                  Class="rounded-circle"
                  Height="200"
                  Width="200"/>
    </div>
</div>

<MudGrid Class="grid">
    <MudItem xs="12" sm="12">
        <MudTextField T="string" @bind-Value="Product.Title" Label="Título"/>
    </MudItem>
    <MudItem xs="12" sm="12">
        <MudTextField T="string" @bind-Value="Product.Description" Label="Descrição"/>
    </MudItem>
    <MudItem xs="12" sm="12">
        <MudTextField T="decimal" AdornmentText="R$" Adornment="Adornment.Start" @bind-Value="Product.Price"
                      Label="Preço"/>
    </MudItem>
    <MudItem xs="12" sm="12">
        <CategorySelector @bind-Value="Product.CategoryId"/>
    </MudItem>
    <MudItem xs="12" sm="12">
        <MudSelect Immediate="true" T="EStatus" @bind-Value="Product.Status" Label="Status">
            <MudSelectItem T="EStatus" Value="EStatus.Active">Ativo</MudSelectItem>
            <MudSelectItem T="EStatus" Value="EStatus.Inactive">Inativo</MudSelectItem>
        </MudSelect>
    </MudItem>
    <MudItem xs="12" sm="12">
        <MudText Typo="Typo.h6" Class="mb-6">Locais de Estoque</MudText>
        <MudTable Items="Locations"
                  Style="background-color: transparent"
                  Elevation="0"
                  ReadOnly="true">
            <HeaderContent>
                <MudTh>Local</MudTh>
                <MudTh>Quantidade</MudTh>
                <MudTh>Quantidade Mínima</MudTh>
                <MudTh>Quantidade Máxima</MudTh>
                <MudTh></MudTh>
            </HeaderContent>
            <RowTemplate>
                <MudTd>@context.LocationTitle</MudTd>
                <MudTd>@context.Quantity</MudTd>
                <MudTd>@context.MinQuantity</MudTd>
                <MudTd>@context.MaxQuantity</MudTd>
                <MudTd>
                    <MudIconButton Color="Color.Error" Icon="@Icons.Material.Filled.Delete"
                                   OnClick="@(() => OnDeleteProductStockButtonClicked(context.LocationId, context.LocationTitle))"/>
                </MudTd>
            </RowTemplate>
        </MudTable>

        <MudGrid Class="mt-3">
            <MudItem xs="12" sm="8">
                <MudSelect Label="Adicionar Local" @bind-Value="SelectedLocationId">
                    <MudSelectItem Value="0L" Disabled="true">Selecione um local</MudSelectItem>
                    @foreach (var location in AvailableLocations)
                    {
                        <MudSelectItem Value="@location.Key">@location.Value</MudSelectItem>
                    }
                </MudSelect>
            </MudItem>
            <MudItem>
                <MudTextField 
                    T="int" 
                    Label="Quantidade mínima"
                    Placeholder="Mantenha vazio se não deseja controlar limites de estoque."
                    @bind-Value="NewProductStockMinQuantity"/>            
            </MudItem>
            <MudItem>
                <MudTextField 
                    T="int" 
                    Label="Quantidade máxima"
                    Placeholder="Mantenha vazio se não deseja controlar limites de estoque."
                    @bind-Value="NewProductStockMaxQuantity"/>            
            </MudItem>
            <MudItem xs="12" Class="mt-2">
                <MudButton
                    Color="Color.Primary"
                    OnClick="() => AddLocation(SelectedLocationId, SelectedLocationTitle, NewProductStockMinQuantity, NewProductStockMaxQuantity)">
                    Adicionar Local
                </MudButton>
            </MudItem>
        </MudGrid>
    </MudItem>
    <MudItem xs="12" sm="12" Class="d-flex justify-end mt-4 mb-4">
        <MudButton Variant="Variant.Outlined" Color="Color.Default" OnClick="Cancel">
            Cancelar
        </MudButton>
        <MudButton Class="ml-2" Color="Color.Primary" Variant="Variant.Filled" OnClick="SaveChanges">
            Salvar Produto
        </MudButton>
    </MudItem>
</MudGrid>
